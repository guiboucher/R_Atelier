---
title: "Aide-Mémoire"
subtitle: "Combiner périodes"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "#>")
library(data.table)
library(kableExtra)
library(lubridate)

print_dt <- function(x) {
  kable(
    as.data.frame(x), "latex", booktabs = TRUE,
    row.names = FALSE,
    longtable = TRUE,
    escape = FALSE,
    linesep = "",
    align = "r",
    col.names = linebreak(names(x), align = "c")
  ) %>%
    kable_styling(
      latex_options = c(
        "striped",
        "hold_position",
        "repeat_header"
      ),
      position = "center",
      repeat_header_text = ""
    )
}
```


# Juxtaposition

## Contexte
Transformer plusieurs périodes qui se chevauchent dans le temps en une seule période continue.
```{r, echo=FALSE, results="asis"}
dt <- data.table(
  ID = c(rep(1, 3), rep(2, 2)),
  DIN = c(rep(555, 3), rep(999, 2)),
  DENOM = c(rep(159, 3), rep(357, 2)),
  DatAdm = as.Date(c("2022-03-01","2022-03-15","2022-03-19",
                     "2022-06-01", "2022-06-15")),
  DatDep = as.Date(c("2022-03-25","2022-03-17","2022-03-30",
                     "2022-06-15", "2022-06-19"))
)
```

Tableau d'analyse :
```{r, echo=FALSE}
print_dt(dt)
```

Résultat final voulu :
```{r, echo=FALSE}
dt1 <- data.table(
  ID = 1:2,
  DIN = c(555,999),
  DENOM = c(159, 357),
  DatAdm = as.Date(c("2022-03-01", "2022-06-01")),
  DatDep = as.Date(c("2022-03-30", "2022-06-19"))
)
print_dt(dt1)
```


## Programmation
```{r}
dt[, max_dep := as_date(cummax(as.integer(fcoalesce(shift(DatDep), DatDep)))), .(ID)]
```


































